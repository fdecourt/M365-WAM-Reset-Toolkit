# M365 WAM Reset Toolkit (V8)

Advanced Microsoft 365 token reset and WAM cleanup tool for Windows 10/11.

---

## üß≠ Description

This script allows you to:

- Fully reset Microsoft 365 authentication tokens.
- Clean WAM (Web Account Manager) profiles.
- Reset AzureAD, Workplace Join and Microsoft Account (MSA) sessions.
- Purge Credential Manager saved credentials.
- Reset OneDrive configuration.
- Schedule locked files and directories deletion after reboot (via PendingFileRenameOperations).
- Safely handle locked files during running Office, OneDrive or AzureAD sessions.
- Fully compatible with dual personal & professional Microsoft accounts.

## Why this script exists

I was tired of constantly running into Microsoft 365 (M365) and OneDrive sign-in issues, with no real solution provided by Microsoft or found in community forums.

Typical symptoms include:

- Repeated "Sign in required" prompts.
- Infinite login loops ("Sign-in window keeps popping up").
- Messages like:  
  *"You're not connected"*, *"Can't verify your subscription"*, *"We couldn't connect to the server"*, or *"Activation failed"*.
- OneDrive stuck on *"Signing in..."*, *"Unable to sync files"*, or *"There was a problem connecting to OneDrive"*.
- Apps refusing to activate or asking for credentials every time.
- Common error codes:  
  `0x8004FC12`, `0x8004FC01`, `0xCAA70004`, `0xCAA70007`, `0xCAA20003`, `80070005` (access denied), `AADSTS50020`, `AADSTS50076` (MFA issues).

These issues often come from local authentication data corruption:
- Broken cached credentials
- Invalid authentication tokens (WAM / Web Account Manager)
- Expired certificates (Workplace Join)
- Locked Windows internal files related to M365 sign-in

This script fully resets all Microsoft 365 local sign-in data, allowing Word, Excel, Outlook, Teams, and OneDrive to start fresh, reconnect and synchronize correctly ‚Äî without needing a full reinstall or system reset.

---


## ‚öô Requirements

- Windows 10 or 11 (x64).
- Local admin rights (script must be executed as Administrator).
- A reboot is required after execution to finalize the locked files deletion.

---

## üöÄ How to use

1Ô∏è‚É£ Launch `M365_TOKEN_RESET_V8.ps1` in an elevated PowerShell (Administrator mode).

2Ô∏è‚É£ Let the full reset run until completion.

3Ô∏è‚É£ Reboot the machine to apply all planned deletions.

4Ô∏è‚É£ Reconnect your Microsoft 365 personal and/or professional accounts as needed.

---

## üîß Key features

- Fully transactional cleanup of WAM folders.
- Handles locked files via proper reboot scheduling.
- Fully automated ‚Äî zero manual interaction required.
- Compatible with hybrid identity environments (MSA + AzureAD + Workplace Join + Entra).
- Preserves user profiles and user data.
- Compatible with coexistence of personal & professional M365 accounts.

---

## üö´ Limitations

- This script does not delete user data or profiles.
- Some Intune-managed hybrid devices may require additional permissions.
- PowerShell Desktop Edition required (default on Windows 10/11).

---

## ‚ö† Disclaimer

This script is provided **as is**, without any warranty of any kind.  
Use it at your own risk.  
The author cannot be held responsible for any consequences resulting from its use.

## üìÑ License

This project is licensed under the **Creative Commons Attribution 4.0 International (CC BY 4.0)** license.

- You are free to use, modify, share, and redistribute this script, even commercially.
- You must give appropriate credit to the original author: **fdecourt**.
- Full license text: https://creativecommons.org/licenses/by/4.0/
---

## üë®‚Äçüíª Author

Originally written and field-tested by fdecourt

---

# **VERSION FRAN√áAISE**

---

# M365 WAM Reset Toolkit (V8)

Outil avanc√© de r√©initialisation des jetons Microsoft 365 et de nettoyage complet de WAM pour Windows 10/11.

---

## üß≠ Description

Ce script permet de :

- R√©initialiser compl√®tement les jetons d‚Äôauthentification Microsoft 365.
- Purger les profils WAM (Web Account Manager).
- R√©initialiser les sessions AzureAD, Workplace Join et comptes personnels Microsoft (MSA).
- Vider les identifiants enregistr√©s dans le Credential Manager.
- R√©initialiser la configuration de OneDrive.
- Planifier la suppression des fichiers verrouill√©s au red√©marrage (via PendingFileRenameOperations).
- G√©rer proprement les fichiers verrouill√©s m√™me lorsque Office, OneDrive ou AzureAD sont encore actifs.
- Compatible avec la coexistence de comptes professionnels et personnels Microsoft 365.

## Pourquoi ce script existe

J'en avais marre de rencontrer r√©guli√®rement des probl√®mes de connexion avec Microsoft 365 (M365) et OneDrive, sans solution propos√©e par Microsoft ou sur les forums d'entraide.

Les sympt√¥mes les plus fr√©quents sont :

- Messages r√©p√©t√©s *"Veuillez vous reconnecter"* ou *"Connexion requise"*.
- Boucles infinies de connexion (*"La fen√™tre de connexion r√©appara√Æt en boucle"*).
- Messages d'erreur du type :  
  *"Vous n'√™tes pas connect√©"*, *"Impossible de v√©rifier votre abonnement"*, *"Impossible de se connecter au serveur"*, *"L'activation a √©chou√©"*.
- OneDrive bloqu√© sur *"Connexion en cours..."*, *"Impossible de synchroniser les fichiers"*, ou *"Un probl√®me est survenu lors de la connexion √† OneDrive"*.
- Applications Office demandant les identifiants √† chaque ouverture.
- Codes d'erreur fr√©quents :  
  `0x8004FC12`, `0x8004FC01`, `0xCAA70004`, `0xCAA70007`, `0xCAA20003`, `80070005` (acc√®s refus√©), `AADSTS50020`, `AADSTS50076` (MFA, double authentification).

Ces dysfonctionnements proviennent tr√®s souvent d'une corruption des donn√©es d'identification locales :
- Identifiants stock√©s obsol√®tes ou incoh√©rents
- Jetons de connexion invalides (WAM / Web Account Manager)
- Certificats expir√©s (Workplace Join)
- Fichiers syst√®mes Windows verrouill√©s li√©s √† l'authentification M365

Ce script r√©initialise en profondeur toutes les donn√©es locales d'authentification Microsoft 365, permettant √† Word, Excel, Outlook, Teams et OneDrive de repartir sur une base propre et de se reconnecter normalement, sans devoir r√©installer Windows ou r√©initialiser enti√®rement le poste.

---


## ‚öô Pr√©-requis

- Windows 10 ou 11 (x64).
- Droits administrateur local (ex√©cution en tant qu‚Äôadministrateur).
- Un red√©marrage est requis apr√®s ex√©cution pour finaliser la suppression des fichiers verrouill√©s.

---

## üöÄ Utilisation

1Ô∏è‚É£ Ex√©cuter `M365_TOKEN_RESET_V8.ps1` via PowerShell en mode administrateur.

2Ô∏è‚É£ Laisser le script s‚Äôex√©cuter jusqu‚Äôau bout.

3Ô∏è‚É£ Red√©marrer la machine pour appliquer toutes les suppressions planifi√©es.

4Ô∏è‚É£ Reconnecter les comptes professionnels et personnels selon les besoins.

---

## üîß Fonctionnalit√©s cl√©s

- Nettoyage transactionnel complet des dossiers WAM.
- Gestion diff√©r√©e des fichiers verrouill√©s via planification de reboot.
- 100% automatis√©, aucune interaction manuelle n√©cessaire.
- Compatible avec les environnements hybrides (MSA + AzureAD + Workplace Join + Entra).
- Ne supprime pas les profils utilisateurs ni les donn√©es locales.
- Supporte la coexistence de comptes M365 personnels et professionnels.

---

## üö´ Limitations

- Ne supprime aucune donn√©e personnelle ni profil utilisateur.
- Certains postes fortement g√©r√©s par Intune peuvent n√©cessiter des droits suppl√©mentaires.
- Fonctionne uniquement sous Windows PowerShell Desktop (par d√©faut sur Windows 10/11).

---

## ‚ö† Avertissement

Ce script est fourni **tel quel**, sans aucune garantie d'aucune sorte.  
Son utilisation est sous la responsabilit√© exclusive de l'utilisateur.  
L'auteur ne pourra √™tre tenu responsable de toute cons√©quence li√©e √† son utilisation.

## üìÑ Licence

Ce projet est sous licence **Creative Commons Attribution 4.0 International (CC BY 4.0)**.

- Vous √™tes libre d'utiliser, modifier, partager et redistribuer ce script, m√™me √† des fins commerciales.
- Vous devez cr√©diter l'auteur original : **fdecourt**.
- Texte complet de la licence : https://creativecommons.org/licenses/by/4.0/

---

## üë®‚Äçüíª Auteur

√âcrit et valid√© sur le terrain par fdecourt
